<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Quote {{ quote.quote_number }}</title>
    <style>
        /* Screen styles */
        body {
            font-family: Arial, sans-serif;
            font-size: 10pt;
            line-height: 1.3;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .print-container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            padding: 15mm;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .no-print {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #2563eb;
            color: white;
            border-radius: 5px;
        }

        .no-print button {
            background: white;
            color: #2563eb;
            border: none;
            padding: 10px 20px;
            font-size: 14pt;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
        }

        .no-print button:hover {
            background: #f0f0f0;
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
            border: 2px solid #000;
            padding: 10px;
        }

        .company-logo {
            max-height: 50px;
            margin-bottom: 5px;
        }

        .company-name {
            font-size: 18pt;
            font-weight: bold;
            color: #000;
        }

        .company-details {
            font-size: 8pt;
            color: #333;
            margin-top: 3px;
        }

        .quote-info {
            margin: 10px 0;
            border: 1px solid #000;
        }

        .info-row {
            display: flex;
            border-bottom: 1px solid #000;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-cell {
            padding: 5px;
            border-right: 1px solid #000;
            font-size: 9pt;
        }

        .info-cell:last-child {
            border-right: none;
        }

        .info-label {
            font-weight: bold;
            min-width: 100px;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 8pt;
        }

        .items-table th,
        .items-table td {
            border: 1px solid #000;
            padding: 4px 2px;
            text-align: center;
        }

        .items-table th {
            background-color: #f0f0f0;
            font-weight: bold;
            font-size: 7pt;
        }

        .items-table .group-row {
            background-color: #f9f9f9;
            font-weight: bold;
        }

        .items-table .sub-item-row td:first-child {
            padding-left: 15px;
            text-align: left;
        }

        .text-left {
            text-align: left !important;
        }

        .text-right {
            text-align: right !important;
        }

        .totals-section {
            margin-top: 10px;
            page-break-inside: avoid;
        }

        .totals-table {
            width: 50%;
            margin-left: auto;
            font-size: 9pt;
        }

        .totals-table td {
            padding: 3px 5px;
        }

        .total-row {
            font-weight: bold;
            border-top: 2px solid #000;
        }

        .account-details {
            margin-top: 15px;
            padding: 8px;
            border: 1px solid #000;
            font-size: 8pt;
        }

        .payment-terms {
            margin-top: 10px;
            padding: 8px;
            border: 1px solid #000;
            font-size: 8pt;
        }

        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 8pt;
        }

        /* Print styles */
        @media print {
            body {
                background: white;
                padding: 0;
            }

            .print-container {
                max-width: 100%;
                box-shadow: none;
                padding: 0;
            }

            .no-print {
                display: none;
            }
        }

        @page {
            size: A4;
            margin: 10mm;
        }
    </style>
</head>

<body>
    <div class="print-container">
        <!-- Print/Save buttons (hidden when printing) -->
        <div class="no-print">
            <h3 style="margin-top: 0;">Quote Preview</h3>
            <button onclick="window.print()">
                üñ®Ô∏è Print / Save as PDF
            </button>
            <button onclick="window.close()">
                ‚úï Close
            </button>
            <p style="font-size: 10pt; margin-top: 10px;">
                Click "Print / Save as PDF" and choose "Save as PDF" in the print dialog
            </p>
        </div>

        <!-- Header -->
        <div class="header">
            <img src="{{ url_for('static', filename='images/vetrovalogo.png') }}" alt="Logo" class="company-logo"
                onerror="this.style.display='none'">
            <div class="company-name">GLASSY INDIA</div>
            <div class="company-details">
                VETROVA TECH SERVICES PRIVATE LIMITED<br>
                Address: Bangalore Seley Glass - A/2, Bommasandra Industrial Area, Bengaluru, Karnataka 560099<br>
                ‚òé +91 85500 11196 | üìß rohit@glassy.in | üåê www.glassy.in
            </div>
        </div>

        <!-- Quote Information -->
        <div class="quote-info">
            <div class="info-row">
                <div class="info-cell info-label">Quotation Date:</div>
                <div class="info-cell" style="flex: 1;">{{ quote.quote_date.strftime('%d %b, %Y') }}</div>
                <div class="info-cell info-label">Invoice No:</div>
                <div class="info-cell" style="flex: 1;"><strong>{{ quote.quote_number }}</strong></div>
            </div>
            <div class="info-row">
                <div class="info-cell info-label">Expected Date:</div>
                <div class="info-cell" style="flex: 1;">{{ quote.expected_date.strftime('%d %b, %Y') if
                    quote.expected_date else 'N/A' }}</div>
                <div class="info-cell info-label">8th Feb, 2026</div>
                <div class="info-cell" style="flex: 1;"></div>
            </div>
        </div>

        <!-- Customer Details -->
        <div class="quote-info" style="margin-top: 5px;">
            <div class="info-row">
                <div class="info-cell" style="width: 50%;">
                    <div class="info-label">Invoice to:</div>
                    <div><strong>{{ quote.customer_name }}</strong></div>
                    {% if quote.customer_address %}<div>{{ quote.customer_address }}</div>{% endif %}
                    {% if quote.customer_city or quote.customer_state %}
                    <div>{{ quote.customer_city }}{% if quote.customer_city and quote.customer_state %}, {% endif %}{{
                        quote.customer_state }}</div>
                    {% endif %}
                </div>
                <div class="info-cell" style="width: 50%;">
                    <div class="info-label">Dispatch to:</div>
                    <div>{{ quote.dispatch_to or quote.customer_address or 'Same as invoice address' }}</div>
                    {% if quote.self_pickup %}<div><strong>Self pickup</strong></div>{% endif %}
                </div>
            </div>
        </div>

        <!-- Line Items Table -->
        <table class="items-table">
            <thead>
                <tr>
                    <th rowspan="2" style="width: 3%;">S. No</th>
                    <th rowspan="2" style="width: 15%;">Particular</th>
                    <th colspan="2" style="width: 12%;">Actual size<br>(mm)</th>
                    <th rowspan="2" style="width: 5%;">unit</th>
                    <th colspan="2" style="width: 12%;">Chargeable size<br>(mm)</th>
                    <th rowspan="2" style="width: 5%;">Qty</th>
                    <th rowspan="2" style="width: 8%;">Unit square</th>
                    <th rowspan="2" style="width: 10%;">Rate/ square</th>
                    <th rowspan="2" style="width: 10%;">Total</th>
                </tr>
                <tr>
                    <th>width</th>
                    <th>Height</th>
                    <th>width</th>
                    <th>Height</th>
                </tr>
            </thead>
            <tbody>
                {% set ns = namespace(group_num=0) %}
                {% for item in quote.items if not item.parent_id %}
                {% set ns.group_num = ns.group_num + 1 %}
                {% if item.is_group %}
                <!-- Group Row -->
                <tr class="group-row">
                    <td>{{ ns.group_num }}</td>
                    <td colspan="10" class="text-left"><strong>{{ item.particular }}</strong></td>
                </tr>

                <!-- Sub-items -->
                {% set sub_items = item.children|sort(attribute='sort_order') %}
                {% for sub_item in sub_items %}
                <tr class="sub-item-row">
                    <td>&nbsp;</td>
                    <td class="text-left" style="padding-left: 20px;">{{ sub_item.particular }}</td>
                    <td>{{ sub_item.actual_width if sub_item.actual_width else '-' }}</td>
                    <td>{{ sub_item.actual_height if sub_item.actual_height else '-' }}</td>
                    <td>{{ sub_item.unit or 'MM' }}</td>
                    <td>{{ sub_item.chargeable_width if sub_item.chargeable_width else '-' }}</td>
                    <td>{{ sub_item.chargeable_height if sub_item.chargeable_height else '-' }}</td>
                    <td>{{ sub_item.quantity }}</td>
                    <td class="text-right">{{ "{:.4f}".format(sub_item.unit_square) if sub_item.unit_square else
                        '0.0000' }}</td>
                    <td class="text-right">{{ "{:,.2f}".format(sub_item.rate_sqper) }}</td>
                    <td class="text-right">{{ "{:,.2f}".format(sub_item.total) }}</td>
                </tr>
                {% endfor %}
                {% else %}
                <!-- Regular item (no group) -->
                <tr>
                    <td>{{ ns.group_num }}</td>
                    <td class="text-left">{{ item.particular }}</td>
                    <td>{{ item.actual_width if item.actual_width else '-' }}</td>
                    <td>{{ item.actual_height if item.actual_height else '-' }}</td>
                    <td>{{ item.unit or 'MM' }}</td>
                    <td>{{ item.chargeable_width if item.chargeable_width else '-' }}</td>
                    <td>{{ item.chargeable_height if item.chargeable_height else '-' }}</td>
                    <td>{{ item.quantity }}</td>
                    <td class="text-right">{{ "{:.4f}".format(item.unit_square) if item.unit_square else '0.0000' }}
                    </td>
                    <td class="text-right">{{ "{:,.2f}".format(item.rate_sqper) }}</td>
                    <td class="text-right">{{ "{:,.2f}".format(item.total) }}</td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>

        <!-- Totals -->
        <div class="totals-section">
            <table class="totals-table">
                <tr>
                    <td>Subtotal:</td>
                    <td class="text-right">{{ "{:,.2f}".format(quote.subtotal) }}</td>
                </tr>
                {% if quote.delivery_charges > 0 %}
                <tr>
                    <td>Delivery Charges:</td>
                    <td class="text-right">{{ "{:,.2f}".format(quote.delivery_charges) }}</td>
                </tr>
                {% endif %}
                {% if quote.installation_charges > 0 %}
                <tr>
                    <td>Installation Charges:</td>
                    <td class="text-right">{{ "{:,.2f}".format(quote.installation_charges) }}</td>
                </tr>
                {% endif %}
                {% if quote.freight_charges > 0 %}
                <tr>
                    <td>Freight Charges:</td>
                    <td class="text-right">{{ "{:,.2f}".format(quote.freight_charges) }}</td>
                </tr>
                {% endif %}
                {% if quote.transport_charges > 0 %}
                <tr>
                    <td>Transport Charges:</td>
                    <td class="text-right">{{ "{:,.2f}".format(quote.transport_charges) }}</td>
                </tr>
                {% endif %}
                <tr>
                    <td>GST @ {{ quote.gst_percentage }}%:</td>
                    <td class="text-right">{{ "{:,.2f}".format(quote.gst_amount) }}</td>
                </tr>
                <tr>
                    <td>Round Off:</td>
                    <td class="text-right">{{ "{:,.2f}".format(quote.round_off) }}</td>
                </tr>
                <tr class="total-row">
                    <td><strong>Total:</strong></td>
                    <td class="text-right"><strong>‚Çπ{{ "{:,.2f}".format(quote.total) }}</strong></td>
                </tr>
            </table>
            <div style="text-align: right; font-size: 8pt; margin-top: 5px;">
                <strong>In words: Ninety Four Thousand Six Hundred and Ten rupees</strong>
            </div>
        </div>

        <!-- Account Details -->
        <div class="account-details">
            <strong>ACCOUNT DETAILS:</strong><br>
            Name: Vetrova Tech Services Private Limited<br>
            Customer ID: 917321550000158<br>
            IFSC Code: UTIB0000158<br>
            Paytm/UPI: 9513(0)
        </div>

        <!-- Payment Terms -->
        {% if quote.payment_terms %}
        <div class="payment-terms">
            <strong>PAYMENT TERMS:</strong><br>
            {{ quote.payment_terms }}
        </div>
        {% endif %}

        <!-- Footer -->
        <div class="footer">
            <p><strong>For VETROVA TECH SERVICES PRIVATE LIMITED</strong><br>
                (Authorized Signatory)</p>
        </div>
    </div>
</body>

</html>